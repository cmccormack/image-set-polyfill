(function(window,document){var EMPTY="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",IMAGE_SET_RE_TEPMLATE="url\\(['\"]?([^'\"\\)]+)['\"]?\\)\\s*([\\d\\.]+)x?",GET_IMAGE_SET_RE=new RegExp(IMAGE_SET_RE_TEPMLATE,"g"),GET_IMAGE_SET_IMAGE_URL_RE=new RegExp(IMAGE_SET_RE_TEPMLATE,""),forEach=Array.prototype.forEach,devicePixelRatio=window.devicePixelRatio||1;function testImageSet(){var elem=document.createElement("div"),style=["background-image:  -webkit-image-set(url("+EMPTY+") 1.0x)","background-image:  image-set(url("+EMPTY+") 1.0x)"].join(";"),support;elem.setAttribute("style",style);document.body.appendChild(elem);support=GET_IMAGE_SET_RE.test(window.getComputedStyle(elem).background);elem.parentNode.removeChild(elem);return support}function getBackground(elem){var style=elem.getAttribute("style"),bgs;if(!style){return""}bgs=style.split(/\s*;\s*/).filter(function(s){return s.indexOf("background")!==-1});if(bgs.length){return bgs.pop()}return""}function getBestSize(sizes){var key,set;for(key in sizes){if(sizes.hasOwnProperty(key)){set=sizes[key];if(set[0]>=devicePixelRatio){break}}}return"url("+set[1]+")"}function polyfillNode(elem){var bg=getBackground(elem),match=bg.match(GET_IMAGE_SET_RE),sizes=[],best;GET_IMAGE_SET_RE.lastIndex=0;while(match=GET_IMAGE_SET_RE.exec(bg)){sizes.push([Number(match[2]),match[1]])}if(!sizes.length){return}best=getBestSize(sizes);elem.style.backgroundImage=best}function getPolyfilledStyles(styles){var findImageSetRE=/(?:\-(?:webkit|moz)\-)?image\-set\(((?:a|[^a])*)\)/gm,newStyles="",lastIndex=0,match,urls,best;function urlMap(item){var m=item.match(GET_IMAGE_SET_IMAGE_URL_RE);return[Number(m[2]),m[1]]}while(match=findImageSetRE.exec(styles)){urls=match[1].split(/\s*,\s*/).map(urlMap);best=getBestSize(urls);newStyles+=styles.slice(lastIndex,match.index)+best;lastIndex=match.index+match[0].length}newStyles+=styles.slice(lastIndex);return newStyles}function polyfillStyle(styleTag){styleTag.innerHTML=getPolyfilledStyles(styleTag.innerHTML)}function polifillLink(link){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){var styleText,styleTag;if(xhr.readyState===4){styleText=getPolyfilledStyles(xhr.responseText);styleTag=document.createElement("style");styleTag.innerHTML=styleText;link.parentNode.replaceChild(styleTag,link)}};xhr.open("get",link.href);xhr.send()}function main(){forEach.call(document.querySelectorAll("*"),polyfillNode);forEach.call(document.querySelectorAll("style"),polyfillStyle);forEach.call(document.querySelectorAll('link[rel="stylesheet"]'),polifillLink)}function eventsAttach(){var div=document.createElement("div"),supported=false,appendChild=HTMLElement.prototype.appendChild,setAttribute=HTMLElement.prototype.setAttribute;div.addEventListener("DOMNodeInserted",function(){supported=true});div.appendChild(div.cloneNode(true));if(supported){window.addEventListener("DOMNodeInserted",function(e){polyfillNode(e.originalTarget)},false);window.addEventListener("DOMAttrModified",function(e){polyfillNode(e.originalTarget)},false)}else{HTMLElement.prototype.appendChild=function(elem){polyfillNode(elem);return appendChild.apply(this,arguments)};HTMLElement.prototype.setAttribute=function(name,val){var r=setAttribute.apply(this,arguments);if(name==="style"&&val.indexOf("background")!==-1){polyfillNode(this)}return r}}}document.addEventListener("DOMContentLoaded",function(){if(testImageSet()){return}main();eventsAttach()})})(window,document);
